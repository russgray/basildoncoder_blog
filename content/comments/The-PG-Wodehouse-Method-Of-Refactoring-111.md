post_id: The-PG-Wodehouse-Method-Of-Refactoring
Author: Dan
Date: 2008-03-24 01:19:44
Author_Email: noreply@blogger.com
Author_IP: None

... some of you guys talk about refactoring code &quot;that&#39;s too far to the right&quot; like the objective is to make your code look as cute as a button.<br /><br />I tend to get the sneaking suspicion that these types don&#39;t understand that code is run on a machine, in machine code form, and that this is what matters to the successful operation of a program.<br /><br />When I write a program to search for an entry in a four dimensional array with two sparse dimensions, there will be alot of nesting in the text.  Wrapping it in functions so you can un-nest it is *not* going to improve the algorithm, it&#39;s just going to make it slower by introducing parameter stuffing into the loop.<br /><br />I tend to do almost all of my refactoring by:<br /><br />1) removing lazy function calls (strlen() twice!?  regular expressions to find 0x20 space character!?  malloc() every 16-byte struct!?)<br /><br />2) replacing recursion with iteration<br /><br />3) hoisting code out of loops<br /><br />4) removing as many cache and page misses as possible<br /><br />5) refactoring branching to reduced or non-branching form and minimizing other instruction pipe flushes.<br /><br />I find that clean, well written code is self obviating and so rarely comment.  In C, even a scripting language written this way won&#39;t exceed 8000 lines.<br /><br />In rare cases where an obscure trick is used to accomplish something important, I use comments.  This happened twice for my scripting engine - for the lexer switch&#39;s duff&#39;s device, and for the on-the-fly compiler&#39;s stack handling.<br /><br />Best Regards,<br />Dan
